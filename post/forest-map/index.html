<!DOCTYPE html>
<html lang="en-us">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 3.2.0">
  <meta name="generator" content="Hugo 0.55.4" />
  <meta name="author" content="Gustavo Varela Alvarenga">

  
  
  
  
    
  
  <meta name="description" content="Create a Map in R with ggplot and transform it into a gif">

  
  <link rel="alternate" hreflang="pt" href="/pt/post/forest-map/">
  
  <link rel="alternate" hreflang="en-us" href="/post/forest-map/">

  


  

  

  

  

  

  

  
  
  
  <meta name="theme-color" content="#21ABFF">
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha256-eSi1q2PG6J7g7ib17yAaWMcrr5GrtohYChqibrV7PBE=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css" integrity="sha384-5sAR7xN1Nv6T6+dT2mhtzEpVJvfS3NScPQTrOxhwjIuvcA67KV2R5Jz6kr4abQsz" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" integrity="sha256-ygkqlh3CYSUri3LhQxzdcm0n1EQvH2Y+U5S2idbLtxs=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" crossorigin="anonymous">
        
      
    

    

    

  

  
  
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Montserrat:400,700|Roboto:400,400italic,700|Roboto+Mono">
  

  <link rel="stylesheet" href="/styles.css">
  
  <link rel="stylesheet" href="/css/timelineSkillsCSS.css">
  
  <link rel="stylesheet" href="/css/sharelinksCSS.css">
  

  
  
  

  
  <link rel="alternate" href="/index.xml" type="application/rss+xml" title="Gustavo Varela-Alvarenga">
  <link rel="feed" href="/index.xml" type="application/rss+xml" title="Gustavo Varela-Alvarenga">
  

  <link rel="manifest" href="/site.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="/post/forest-map/">

  
  
  
  
    
  
  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="twitter:site" content="@gu-stat">
  <meta property="twitter:creator" content="@gu-stat">
  
  <meta property="og:site_name" content="Gustavo Varela-Alvarenga">
  <meta property="og:url" content="/post/forest-map/">
  <meta property="og:title" content="Create a Map in R with ggplot and transform it into a gif | Gustavo Varela-Alvarenga">
  <meta property="og:description" content="Create a Map in R with ggplot and transform it into a gif"><meta property="og:image" content="/post/forest-map/featured.png">
  <meta property="og:locale" content="en-us">
  
  <meta property="article:published_time" content="2019-04-26T00:00:00-04:00">
  
  <meta property="article:modified_time" content="2019-04-27T00:00:00-04:00">
  

  

  

  <title>Create a Map in R with ggplot and transform it into a gif | Gustavo Varela-Alvarenga</title>

</head>
<body id="top" data-spy="scroll" data-target="#TableOfContents" data-offset="71" >
  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" role="textbox" spellcheck="false" type="search">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


<nav class="navbar navbar-light fixed-top navbar-expand-lg py-0" id="navbar-main">
  <div class="container">

    
      <a class="navbar-brand" href="/">Gustavo Varela-Alvarenga</a>
      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
        <span><i class="fas fa-bars"></i></span>
      </button>
      

    
    <div class="collapse navbar-collapse" id="navbar">

      
      
      <ul class="navbar-nav ml-auto">
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#about">
            
            <span>Home</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#experience">
            
            <span>Experience</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#skills">
            
            <span>Coding</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#projects">
            
            <span>Shiny Apps</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#publications">
            
            <span>Publications</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#contact">
            
            <span>Contact</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/files/CV_Varela_Alvarenga.pdf">
            
            <span>CV</span>
            
          </a>
        </li>

        
        

      

        

        
        <li class="nav-item">
          <a class="nav-link js-search" href="#"><i class="fas fa-search" aria-hidden="true"></i></a>
        </li>
        

        
        <li class="nav-item dropdown">
          <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true">
            <i class="fas fa-globe" aria-hidden="true"></i>
            <span>English</span>
          </a>
          <ul class="dropdown-menu">
            
            <li class="dropdown-item my-0 py-0 mx-0 px-0">
              <a href="/pt/post/forest-map/">
                <span>PortuguÃªs</span>
              </a>
            </li>
            
          </ul>
        </li>
        

        
        <li class="nav-item">
          <a class="nav-link js-dark-toggle" href="#"><i class="fas fa-moon" aria-hidden="true"></i></a>
        </li>
        

      </ul>

    </div>
  </div>
</nav>


<article class="article" itemscope itemtype="http://schema.org/Article">

  












  

  
  
  
<div class="article-container pt-3">
  <h1 itemprop="name">Create a Map in R with ggplot and transform it into a gif</h1>

  

  
    

<div class="article-metadata">

  
  
  
  <div>
    <span itemscope itemprop="author" itemtype="http://schema.org/Person">
      <span itemprop="name">G Varela-Alvarenga</span>
    </span>
    
  </div>
  

  <span class="article-date">
    
        Last updated on
    
    <meta content="2019-04-26 00:00:00 -0400 EDT" itemprop="datePublished">
    <time datetime="2019-04-27 00:00:00 -0400 EDT" itemprop="dateModified">
      Apr 27, 2019
    </time>
  </span>
  <span itemscope itemprop="publisher" itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Gustavo Varela Alvarenga">
  </span>

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    14 min read
  </span>
  

  
  

  

  
  
<div class="share-box" aria-hidden="true">
  <ul class="share">
    
    
    <div class="a2a_kit a2a_kit_size_32 a2a_default_style">
      <a class="a2a_button_whatsapp"></a>
      <a class="a2a_button_twitter"></a>
      <a class="a2a_button_linkedin"></a>
      <a class="a2a_button_facebook"></a>
      <a class="a2a_button_copy_link"></a>
    <a class="a2a_dd" href="https://www.addtoany.com/share"></a>
    </div>
    <script>
      var a2a_config = a2a_config || {};
      a2a_config.linkname = "\"Create a Map in R with ggplot and transform it into a gif\"";
      a2a_config.linkurl = "https://ogustavo.com\/post\/forest-map\/";
    </script>
    <script async src="https://static.addtoany.com/menu/page.js"></script>
    
    
  </ul>
</div>


  

</div>

    







  









  
</div>



  <div class="article-container">

    <div class="article-style" itemprop="articleBody">
      

<h2 id="section-1-intro">Section 1: Intro</h2>

<p>In March 2019, the Brazilian Annual Land Use and Land Cover Mapping Project
(<a href="http://mapbiomas.org/" target="_blank">MapBiomas</a>) launched the Mapbiomas v.3.1 data
set on land use and land cover for the period of 1985 to 2017.</p>

<p>This data set has information about the total area (in hectares) of forest
formations, non-forest natural formations, farming, non-vegetated areas and
water bodies - detailed information about these and their subdivisions can be
found <a href="https://storage.googleapis.com/mapbiomas/assets/colecao-3-0/mapas-dados/1%20-%20Legenda%20Cole%C3%A7%C3%A3o%203%20-%20Descricao%20Detalhada_ENG.pdf" target="_blank">here</a>.</p>

<p>And even though their website provides tools for anyone to create their own maps, I&rsquo;ve decided to create my own animated map using R and the <code>ggplot2</code> and <code>gifski</code> packages because I wanted to see the percentage
of a city area that is covered by native vegetation.
I&rsquo;m also using the <code>brazilmaps</code> package to plot Brazil&rsquo;s map.</p>

<p>I wanted to focus on Natural Forest Formation data only and see how its total area evolved since 1985.</p>

<p>This tutorial has 3 sections, besides this introduction. The second section just goes over the packages and fonts that I used and how to download these fonts. In Section 3, I go over the data set and talk about its variables and their definitions. I also go over steps of importing the data set and doing some data manipulation to obtain the information that I want. Section 4 gives you the code for the final map.</p>

<p>You can download the <code>.R</code> file with the complete code from my <a href="https://github.com/gu-stat/forest-area" target="_blank">GitHub</a>.</p>

<h2 id="section-2-packages">Section 2: Packages</h2>

<p>I&rsquo;ll begin by going over the fonts I used and how to install them. I use Windows, so I don&rsquo;t know if the same steps apply to other systems (sorry Mac and Unix users).</p>

<p>I&rsquo;m using Lato, an open-source font family. So, make sure you download
and install the Lato font before we start or you can just let R use the default system font - you won&rsquo;t have to change the code, you will get some warning messages, but R will still plot the map.</p>

<p>You can download it from <a href="http://www.latofonts.com/lato-free-fonts/" target="_blank">here</a>.</p>

<p>The first thing I do is make sure that R can use this font, so I&rsquo;ll use the <code>extrafont</code> package for that. If it&rsquo;s your first time using these fonts you&rsquo;ll have to run the <code>font_import()</code> command (this might take a while depending on the number of installed fonts you have, the good thing is that you&rsquo;ll have to run this command only once).</p>

<pre><code class="language-r"># ************************************************************************* ----
# extrafont Package                                                         ----
# ************************************************************************* ----

#install.packages(&quot;extrafont&quot;)

library(&quot;extrafont&quot;)

# ************************************************************************* ----
# Import Font                                                               ----
# ************************************************************************* ----

# Install font Lato

# Run font_import only once:

# font_import()

# Check if Lato was imported
fonts()[grep(&quot;Lato&quot;, fonts())]
</code></pre>

<pre><code>## [1] &quot;Lato Black&quot;    &quot;Lato&quot;          &quot;Lato Hairline&quot; &quot;Lato Light&quot;   
## [5] &quot;Lato Medium&quot;   &quot;Lato Thin&quot;
</code></pre>

<pre><code class="language-r"># Register the fonts with R

loadfonts(device = &quot;win&quot;)

# ************************************************************************* ----
# Remaining Packages                                                        ----
# ************************************************************************* ----

#install.packages(&quot;openxlsx&quot;)
#install.packages(&quot;tidyverse&quot;)
#install.packages(&quot;brazilmaps&quot;)
#install.packages(&quot;gifski&quot;)

library(&quot;openxlsx&quot;)
library(&quot;tidyverse&quot;)
library(&quot;brazilmaps&quot;)
library(&quot;gifski&quot;)
</code></pre>

<h2 id="section-3-the-data">Section 3: The Data</h2>

<h3 id="credit-where-credit-is-due">Credit Where Credit is Due</h3>

<p>The MapBiomas data are public, open and free through the simple reference of the source:</p>

<p>&ldquo;Project MapBiomas - Collection 3.1 of Brazilian Land Cover &amp; Use Map Series, accessed on 04/24/2019 through the link:
(<a href="http://mapbiomas.org/pages/estatisticas&quot;" target="_blank">http://mapbiomas.org/pages/estatisticas&quot;</a>)</p>

<p>&ldquo;MapBiomas Project - is a multi-institutional initiative to generate annual land cover and use maps using automatic classification processes applied to satellite images. The complete description of the project can be found at <a href="http://mapbiomas.org" target="_blank">http://mapbiomas.org</a>&ldquo;</p>

<p>I&rsquo;m also using data on the area of the cities in Brazil from IBGE (the Brazilian Institute of Geography and Statistics). Due to changes in the size of the cities over the years, I&rsquo;ve decided to use data from 2016. I was getting some incorrect results using data from 2017 or 2018, like cities with over 100% of their area covered by native vegetation. Clearly, these cities were divided but this wasn&rsquo;t accounted for in MapBiomas&rsquo; data set. No cities with over 100% of their area covered by native vegetation were observed when using 2016 data.</p>

<p>The code below imports the data sets to R, but if you want you can download the
xlsx files from the official sites by clicking <a href="https://storage.googleapis.com/mapbiomas/mapbiomas-br/v3-1/planilhas%20de%20estatisticas%203-1/Dados_Cobertura_MapBiomas_3.1_Biomas-UF-Municipios_%20SITE.xlsx" target="_blank">here</a> for MapBiomas&rsquo; data set and <a href="ftp://geoftp.ibge.gov.br/organizacao_do_territorio/estrutura_territorial/areas_territoriais/2016/AR_BR_RG_UF_MUN_2016.xls" target="_blank">here</a> for IBGE&rsquo;s data set.</p>

<p>For the sake of maintaining my code, I&rsquo;m also uploading the original databases to
my <a href="https://github.com/gu-stat/forest-area" target="_blank">GitHub repository</a> and that&rsquo;s the
data I&rsquo;ll use in my code below.</p>

<h3 id="data-dictionary">Data Dictionary</h3>

<p>MapBiomas&rsquo; xlsx file has the following worksheet:</p>

<ul>
<li>INSTRUCTIONS;</li>
<li>LAND COVER - BIOMAS e UF;</li>
<li>LAND COVER - MUN_UF;</li>
<li>CONSULTA BIOMA-UF; and</li>
<li>CONSULTA MUN-UF.</li>
</ul>

<p>I&rsquo;ll use the LAND COVER - MUN_UF worksheet. The variables in this worksheet are:</p>

<table>
<thead>
<tr>
<th>Variable</th>
<th>Class</th>
<th>Description</th>
</tr>
</thead>

<tbody>
<tr>
<td>COD_ESTADO</td>
<td>numeric</td>
<td>state identifier</td>
</tr>

<tr>
<td>estado</td>
<td>character</td>
<td>state name</td>
</tr>

<tr>
<td>CODIBGE</td>
<td>numeric</td>
<td>city identifier</td>
</tr>

<tr>
<td>municipio</td>
<td>character</td>
<td>city name</td>
</tr>

<tr>
<td>cod.classe</td>
<td>numeric</td>
<td>land cover class identifier</td>
</tr>

<tr>
<td>nivel1</td>
<td>character</td>
<td>class level 1</td>
</tr>

<tr>
<td>nivel2</td>
<td>character</td>
<td>class level 2</td>
</tr>

<tr>
<td>nivel3</td>
<td>character</td>
<td>class level 3</td>
</tr>

<tr>
<td>1985</td>
<td>numeric</td>
<td>covered area in hectares(ha) in 1985</td>
</tr>

<tr>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
</tr>

<tr>
<td>2017</td>
<td>numeric</td>
<td>covered area in hectares(ha) in 2017</td>
</tr>
</tbody>
</table>

<p>IBGE&rsquo;s xlsx file has the following worksheet.</p>

<ul>
<li>AR_BR_MUN_2016;</li>
<li>AR_BR_UF_2016;</li>
<li>AR_BR_RG_2016; and</li>
<li>AR_BR_2016.</li>
</ul>

<p>I&rsquo;ll use the AR_BR_MUN_2016 worksheet. The variables in this worksheet are:</p>

<table>
<thead>
<tr>
<th>Variable</th>
<th>Class</th>
<th>Description</th>
</tr>
</thead>

<tbody>
<tr>
<td>ID</td>
<td>numeric</td>
<td>ID</td>
</tr>

<tr>
<td>CD_GCUF</td>
<td>character</td>
<td>state identifier</td>
</tr>

<tr>
<td>NM_UF</td>
<td>character</td>
<td>state name</td>
</tr>

<tr>
<td>NM_UF_SIGLA</td>
<td>character</td>
<td>state abbreviation</td>
</tr>

<tr>
<td>CD_GCMUN</td>
<td>character</td>
<td>city identifier</td>
</tr>

<tr>
<td>NM_MUN_2016</td>
<td>character</td>
<td>city name</td>
</tr>

<tr>
<td>AR_MUN_2016</td>
<td>numeric</td>
<td>area in squared km</td>
</tr>
</tbody>
</table>

<p>I&rsquo;m also creating the data set <code>brazil.map</code> with the shapefiles
to plot Brazil&rsquo;s map divided by city using the function <code>brazilmaps::get_brmap</code>.</p>

<pre><code class="language-r"># ************************************************************************* ----
# Data Import                                                               ----
# ************************************************************************* ----
# Change number format
options(scipen=10)

# File Path on GitHub
file_path_forest_area = paste0(
  &quot;https://github.com/gu-stat/forest-area/blob/master/&quot;,
  &quot;data/Dados_Cobertura_MapBiomas_3.1_Biomas-UF-Municipios_%20SITE_UNPROTECTED.xlsx&quot;,
  &quot;?raw=true&quot;)

file_path_city_area = paste0(
  &quot;https://github.com/gu-stat/forest-area/blob/master/&quot;,
  &quot;data/AR_BR_RG_UF_MUN_2016.xlsx&quot;,
  &quot;?raw=true&quot;)

# Import
df.original &lt;- openxlsx::read.xlsx(file_path_forest_area, 
                                   sheet = &quot;LAND COVER - MUN_UF&quot;)

df.city.area &lt;- openxlsx::read.xlsx(file_path_city_area, 
                                    sheet = &quot;AR_BR_MUN_2016&quot;)

## \__ Map Data by City ----

brazil.map &lt;- get_brmap(geo = &quot;City&quot;, class = &quot;sf&quot;)
</code></pre>

<h3 id="data-manipulation">Data Manipulation</h3>

<pre><code class="language-r"># ************************************************************************* ----
# Data Manipulation                                                         ----
# ************************************************************************* ----

## \__ Transform City Code into Numeric ----

df.city.area2 &lt;-
  df.city.area %&gt;% 
  dplyr::mutate(CODIBGE = as.numeric(CD_GCMUN)) %&gt;% 
  dplyr::select(CODIBGE, AR_MUN_2016)


## \__ Natural Forest Coverage Area Data ----

df.nat.forest &lt;- 
  df.original %&gt;% 
  filter(nivel2 == &quot;Floresta Natural&quot;) %&gt;%
  select(COD_ESTADO, estado, CODIBGE, nivel2, nivel3, 
         paste0(seq(1985, 2017))
  ) %&gt;%
  # SUM THE DIFFERENT SUB-GROUPS OF NATURAL FOREST
  group_by(COD_ESTADO, estado, CODIBGE) %&gt;%
  summarize_at(vars(-nivel2,-nivel3),sum) %&gt;%
  ungroup()

## \__ Join with City Area Data ----

df.nat.forest.AREA &lt;- 
  df.nat.forest %&gt;%
  # ADD TOTAL AREA OF MUNICIPALITY TO DATA SET
  dplyr::left_join(x = ., y = df.city.area2, by = &quot;CODIBGE&quot;) %&gt;%
  # CREATE PERCENTAGES
  ## Divide x/100 to transform from hectares to squared km
  dplyr::mutate_at(.vars=vars(paste0(seq(1985,2017))), 
                   .fun = function(x) round(100*((x/100)/.$AR_MUN_2016),3)
  )
  

# CHECK IF ANYTHING GREATER THAN 100%
greater.1 &lt;- NULL 
for (i in 1985:2017) {
  greater.1 &lt;- append(greater.1, which(df.nat.forest.AREA[,paste0(i)] &gt;= 100))
}

greater.1 &lt;- greater.1 %&gt;% unlist() %&gt;% unique()

## \__ Create Percentages Breaks ----

df.nat.forest.AREA &lt;- 
  df.nat.forest.AREA %&gt;%
  dplyr::mutate_at(.vars=vars(paste0(seq(1985,2017))), 
                   .fun = function(x) cut(x,breaks=c(-Inf, 0, 1, seq(0, 100, 10)[-1]))
  )
</code></pre>

<h2 id="section-4-the-map">Section 4: The Map</h2>

<pre><code class="language-r"># ************************************************************************* ----
# Map                                                                       ----
# ************************************************************************* ----

## \__ Function that Joins Map Data by City with Forest Area Data ----

create.map.df &lt;- function(DATA){
  
  map &lt;- join_data(map = brazil.map, data = DATA, by = c(&quot;City&quot; = &quot;CODIBGE&quot;))  
  
  map.ggplot &lt;- as(map, &quot;Spatial&quot;)
  
  map.ggplot@data$id = row.names(map.ggplot@data)
  
  df.map.ggplot &lt;- suppressMessages(ggplot2::fortify(map.ggplot))
  
  df.map.ggplot &lt;- dplyr::left_join(df.map.ggplot, map.ggplot@data, by = &quot;id&quot;)
  
  return(df.map.ggplot)
}

## \____ Map Data for Plot ----

df.map.ggplot &lt;- create.map.df(df.nat.forest.AREA)

## \__ Map Colors ----

# USE https://gka.github.io/palettes TO GET
# COLOR SCALE FROM white TO darkgreen
# THAT'S ALSO SUITABLE TO COLORBLIND PEOPLE WITH 12 BREAKS 
# SAME NUMBER AS THE LEVELS OF cut(x,breaks=c(-Inf, 0, 1, seq(0, 100, 10)[-1]))

map.colors &lt;- c('#ffffff','#eaf1e7','#d4e2cf','#bfd4b8','#abc5a1','#96b78a',
                '#81a974','#6c9b5f','#588d4a','#428034','#28711d','#006400')

### \__ Map Labels ----

map.labels &lt;- c(&quot;0&quot;, &quot;&quot;, &quot;10%&quot;, rep(&quot;&quot;,3), &quot;50%&quot;, rep(&quot;&quot;,3), &quot;90%&quot;, &quot;&quot;)

## \__ Create Theme ----

map.theme &lt;-
  theme(
    text = element_text(size = 13, family = &quot;Lato&quot;, color = &quot;#f2efef&quot;),
    axis.text = element_blank(),
    axis.title.x = element_blank(),
    axis.title.y = element_blank(),
    plot.background = element_rect(fill = &quot;#3a3935&quot;, color = NA), 
    panel.background = element_rect(fill = &quot;#3a3935&quot;, color = NA),
    panel.grid = element_blank(),
    plot.margin = margin(t = 0.25,r = 0.25,b = 0.25,l = 0.25,unit = &quot;cm&quot;),
    plot.title = element_text(margin = margin(t = 0.25, unit = &quot;cm&quot;)),
    plot.caption = element_text(size = 10),
    legend.background = element_rect(fill = &quot;#3a3935&quot;, color = &quot;#3a3935&quot;),
    legend.text = element_text(size = 11),
    legend.title = element_text(size = 12),
    legend.position = &quot;left&quot;,
    legend.key = element_rect(color = &quot;transparent&quot;),
    legend.key.size = unit(0, units = &quot;mm&quot;),
    legend.key.width = unit(2, units = &quot;mm&quot;)
  )

## \__ Plot Map ----

### \____ Function for GIF ----
plot.map.forest &lt;- function(){
  for (i in 1985:2017) {

    lost.area.year.km2 &lt;-
      round(
        sum(-(df.nat.forest %&gt;% summarize_at(paste0(i),sum)/100),
            df.nat.forest %&gt;% summarize_at(paste0(1985),sum)/100)
        ,2
      )

    lost.area.year.mi2 &lt;- round(lost.area.year.km2/2.59, 2)

    map.forest &lt;-
      # MAP
      ggplot(mapping = aes(x = long, y = lat, group = group)) +
      # MAP WITH TRANSPARENT CITY LINES
      geom_polygon(
        data = df.map.ggplot,
        aes_string(fill = paste0(&quot;X&quot;,i)),
        color = &quot;transparent&quot;
      ) +
      # LEGEND
      scale_fill_manual(
        values = map.colors,
        drop = FALSE,
        na.value = &quot;black&quot;,
        na.translate = FALSE,
        name = &quot;&quot;,
        label = map.labels,
        guide = guide_legend(
          direction = &quot;vertical&quot;,
          ncol = 1,
          reverse = TRUE,
          label.vjust = 2.5
        )
      ) +
      # MAP LIMITS
      xlim(range(df.map.ggplot$long)) +
      ylim(range(df.map.ggplot$lat)) +
      coord_map() +
      # ADD TITLE AND CAPTIONS
      labs(
        title = &quot;Percentage of City Area Covered By Native Vegetation, Brazil.&quot;,
        caption = paste0(&quot;Map: Gustavo Varela-Alvarenga - ogustavo.com \n \n &quot;,
                         &quot;Data: MapBiomas v.3.1 - mapbiomas.org &amp; &quot;,
                         &quot;IBGE - www.ibge.gov.br &quot;)
      ) +
      # ADD THEME
      map.theme +
      # ADD ANNOTATIONS
      ## WORD YEAR
      annotate(
        geom = &quot;text&quot;, x = -44.1, y = 2.4, size = 4, family = &quot;Lato&quot;,
        color = &quot;#f2efef&quot;, label = &quot;year&quot;, angle = 90
      ) +
      ## ACTUAL YEAR
      annotate(
        geom = &quot;text&quot;, x = -40, y = 2.5, size = 10, family = &quot;Lato&quot;,
        color = &quot;#f2efef&quot;, label = paste0(i)
      ) +
      ## TITLE - TABLE ON THE LEFT
      annotate(
        geom = &quot;text&quot;, x = -68.5, y = -26, size = 4, family = &quot;Lato&quot;,
        color = &quot;#f2efef&quot;, hjust = 0.5,
        label =
          paste0(&quot;Total Area of Native \n&quot;, &quot;Vegetation Lost Since 1985&quot;)
      ) +
      ## LINE BELOW TITLE
      annotate(
        geom = &quot;segment&quot;, x = -64.5, xend = -72.5, y = -28, yend = -28,
        linetype = &quot;solid&quot;, color = &quot;#f2efef&quot;
      ) +
      ## VALUES IN KM2 WITH . TO MARK THOUSANDS
      annotate(
        geom = &quot;text&quot;, x = -68.5, y = -29, size = 4.5, family = &quot;Lato&quot;,
        color = &quot;#f2efef&quot;, hjust = 0.5,
        label =
          ifelse(lost.area.year.km2 == 0, &quot;0&quot;,
                 paste0(prettyNum(round(lost.area.year.km2, 0),
                                  big.mark=&quot;.&quot;, decimal.mark = &quot;,&quot;),
                        &quot; sq km&quot;)
          )
      ) +
      ## VALUES IN MI2 WITH , TO MARK THOUSANDS
      annotate(
        geom = &quot;text&quot;, x = -68.5, y = -31, size = 4.5, family = &quot;Lato&quot;,
        color = &quot;#f2efef&quot;, hjust = 0.5,
        label =
          ifelse(lost.area.year.mi2 == 0, &quot;0&quot;,
                 paste0(prettyNum(round(lost.area.year.mi2, 0), big.mark=&quot;,&quot;),
                        &quot; sq miles&quot;)
          )
      ) +
      ## LINE BELOW TABLE
      annotate(
        geom = &quot;segment&quot;, x = -64.5, xend = -72.5, y = -32, yend = -32,
        linetype = &quot;solid&quot;, color = &quot;#f2efef&quot;
      ) +
      ## TITLE - TABLE ON THE RIGHT
      annotate(
        geom = &quot;text&quot;, x = -39, y = -26, size = 4, family = &quot;Lato&quot;,
        color = &quot;#f2efef&quot;, hjust = 0.5,
        label =  paste0(&quot;Lost Area as \n&quot;, &quot;% of the Area of&quot;)
      ) +
      ## LINE BELOW TITLE
      annotate(
        geom = &quot;segment&quot;, x = -35, xend = -43, y = -28, yend = -28,
        linetype = &quot;solid&quot;, color = &quot;#f2efef&quot;
      ) +
      ## ADD WORD TEXAS
      annotate(
        geom = &quot;text&quot;, x = -41, y = -29, size = 4.5, family = &quot;Lato&quot;,
        color = &quot;#f2efef&quot;, label =  &quot;Texas       : &quot;
      ) +
      ## ADD VALUE FOR TEXAS
      annotate(
        geom = &quot;text&quot;, x = -34, y = -29, size = 4.5, family = &quot;Lato&quot;,
        color = &quot;#f2efef&quot;, hjust = 1,
        label =
          ifelse(
            lost.area.year.km2 == 0, &quot;0%&quot;,
            paste0(round(lost.area.year.km2/696241, 2) * 100, &quot;%&quot;)
          )
      ) +
      ## ADD WORD GERMANY
      annotate(
        geom = &quot;text&quot;, x = -41, y = -31, size = 4.5, family = &quot;Lato&quot;,
        color = &quot;#f2efef&quot;, label =  &quot;Germany : &quot;
      ) +
      ## ADD VALUE FOR GERMANY
      annotate(
        geom = &quot;text&quot;, x = -34, y = -31, size = 4.5, family = &quot;Lato&quot;,
        color = &quot;#f2efef&quot;, hjust = 1,
        label =
          ifelse(
            lost.area.year.km2 == 0, &quot;0%&quot;,
            paste0(round(lost.area.year.km2/357386, 2) * 100, &quot;%&quot;)
          )
      ) +
      ## LINE BELOW TABLE
      annotate(
        geom = &quot;segment&quot;, x = -35, xend = -43, y = -32, yend = -32,
        linetype = &quot;solid&quot;, color = &quot;#f2efef&quot;
      )

    print(map.forest)

  }
}
</code></pre>

<pre><code class="language-r">### \____ Create GIF ----
### Be mindful that this will save a gif file named forest_animation.gif into
### your working directory

gif_file &lt;-
  gifski::save_gif(
    expr = plot.map.forest(),
    gif_file = &quot;forest_animation.gif&quot;,
    delay = 0.75, width = 738, height = 788, res = 100
  )

utils::browseURL(gif_file)
</code></pre>

<p><img src="https://raw.githubusercontent.com/gu-stat/forest-area/master/gif/forest_animation.gif"/></p>

<p>If you want you can you use the code below to get high-quality static images of the maps. Be mindful that this will save the plots into your working directory.</p>

<pre><code class="language-r">#install.packages(&quot;Cairo&quot;)
library(&quot;Cairo&quot;)

for (i in 1985:2017) {

    lost.area.year.km2 &lt;-
      round(
        sum(-(df.nat.forest %&gt;% summarize_at(paste0(i),sum)/100),
            df.nat.forest %&gt;% summarize_at(paste0(1985),sum)/100)
        ,2
      )

    lost.area.year.mi2 &lt;- round(lost.area.year.km2/2.59, 2)

    map.forest &lt;-
      # MAP
      ggplot(mapping = aes(x = long, y = lat, group = group)) +
      # MAP WITH TRANSPARENT CITY LINES
      geom_polygon(
        data = df.map.ggplot,
        aes_string(fill = paste0(&quot;X&quot;,i)),
        color = &quot;transparent&quot;
      ) +
      # LEGEND
      scale_fill_manual(
        values = map.colors,
        drop = FALSE,
        na.value = &quot;black&quot;,
        na.translate = FALSE,
        name = &quot;&quot;,
        label = map.labels,
        guide = guide_legend(
          direction = &quot;vertical&quot;,
          ncol = 1,
          reverse = TRUE,
          label.vjust = 2.5
        )
      ) +
      # MAP LIMITS
      xlim(range(df.map.ggplot$long)) +
      ylim(range(df.map.ggplot$lat)) +
      coord_map() +
      # ADD TITLE AND CAPTIONS
      labs(
        title = &quot;Percentage of City Area Covered By Native Vegetation, Brazil.&quot;,
        caption = paste0(&quot;Map: Gustavo Varela-Alvarenga - ogustavo.com \n \n &quot;,
                         &quot;Data: MapBiomas v.3.1 - mapbiomas.org &amp; &quot;,
                         &quot;IBGE - www.ibge.gov.br &quot;)
      ) +
      # ADD THEME
      map.theme +
      # ADD ANNOTATIONS
      ## WORD YEAR
      annotate(
        geom = &quot;text&quot;, x = -44.1, y = 2.4, size = 4, family = &quot;Lato&quot;,
        color = &quot;#f2efef&quot;, label = &quot;year&quot;, angle = 90
      ) +
      ## ACTUAL YEAR
      annotate(
        geom = &quot;text&quot;, x = -40, y = 2.5, size = 10, family = &quot;Lato&quot;,
        color = &quot;#f2efef&quot;, label = paste0(i)
      ) +
      ## TITLE - TABLE ON THE LEFT
      annotate(
        geom = &quot;text&quot;, x = -68.5, y = -26, size = 4, family = &quot;Lato&quot;,
        color = &quot;#f2efef&quot;, hjust = 0.5,
        label =
          paste0(&quot;Total Area of Native \n&quot;, &quot;Vegetation Lost Since 1985&quot;)
      ) +
      ## LINE BELOW TITLE
      annotate(
        geom = &quot;segment&quot;, x = -64.5, xend = -72.5, y = -28, yend = -28,
        linetype = &quot;solid&quot;, color = &quot;#f2efef&quot;
      ) +
      ## VALUES IN KM2 WITH . TO MARK THOUSANDS
      annotate(
        geom = &quot;text&quot;, x = -68.5, y = -29, size = 4.5, family = &quot;Lato&quot;,
        color = &quot;#f2efef&quot;, hjust = 0.5,
        label =
          ifelse(lost.area.year.km2 == 0, &quot;0&quot;,
                 paste0(prettyNum(round(lost.area.year.km2, 0),
                                  big.mark=&quot;.&quot;, decimal.mark = &quot;,&quot;),
                        &quot; sq km&quot;)
          )
      ) +
      ## VALUES IN MI2 WITH , TO MARK THOUSANDS
      annotate(
        geom = &quot;text&quot;, x = -68.5, y = -31, size = 4.5, family = &quot;Lato&quot;,
        color = &quot;#f2efef&quot;, hjust = 0.5,
        label =
          ifelse(lost.area.year.mi2 == 0, &quot;0&quot;,
                 paste0(prettyNum(round(lost.area.year.mi2, 0), big.mark=&quot;,&quot;),
                        &quot; sq miles&quot;)
          )
      ) +
      ## LINE BELOW TABLE
      annotate(
        geom = &quot;segment&quot;, x = -64.5, xend = -72.5, y = -32, yend = -32,
        linetype = &quot;solid&quot;, color = &quot;#f2efef&quot;
      ) +
      ## TITLE - TABLE ON THE RIGHT
      annotate(
        geom = &quot;text&quot;, x = -39, y = -26, size = 4, family = &quot;Lato&quot;,
        color = &quot;#f2efef&quot;, hjust = 0.5,
        label =  paste0(&quot;Lost Area as \n&quot;, &quot;% of the Area of&quot;)
      ) +
      ## LINE BELOW TITLE
      annotate(
        geom = &quot;segment&quot;, x = -35, xend = -43, y = -28, yend = -28,
        linetype = &quot;solid&quot;, color = &quot;#f2efef&quot;
      ) +
      ## ADD WORD TEXAS
      annotate(
        geom = &quot;text&quot;, x = -41, y = -29, size = 4.5, family = &quot;Lato&quot;,
        color = &quot;#f2efef&quot;, label =  &quot;Texas       : &quot;
      ) +
      ## ADD VALUE FOR TEXAS
      annotate(
        geom = &quot;text&quot;, x = -34, y = -29, size = 4.5, family = &quot;Lato&quot;,
        color = &quot;#f2efef&quot;, hjust = 1,
        label =
          ifelse(
            lost.area.year.km2 == 0, &quot;0%&quot;,
            paste0(round(lost.area.year.km2/696241, 2) * 100, &quot;%&quot;)
          )
      ) +
      ## ADD WORD GERMANY
      annotate(
        geom = &quot;text&quot;, x = -41, y = -31, size = 4.5, family = &quot;Lato&quot;,
        color = &quot;#f2efef&quot;, label =  &quot;Germany : &quot;
      ) +
      ## ADD VALUE FOR GERMANY
      annotate(
        geom = &quot;text&quot;, x = -34, y = -31, size = 4.5, family = &quot;Lato&quot;,
        color = &quot;#f2efef&quot;, hjust = 1,
        label =
          ifelse(
            lost.area.year.km2 == 0, &quot;0%&quot;,
            paste0(round(lost.area.year.km2/357386, 2) * 100, &quot;%&quot;)
          )
      ) +
      ## LINE BELOW TABLE
      annotate(
        geom = &quot;segment&quot;, x = -35, xend = -43, y = -32, yend = -32,
        linetype = &quot;solid&quot;, color = &quot;#f2efef&quot;
      )

    ### Be mindful that this will save several png files named Y*.png, 
    ### where * is the year, into your working directory
    
    ggsave(
      paste0(&quot;Y&quot;,i,&quot;.png&quot;), device=&quot;png&quot;, type=&quot;cairo&quot;, 
      width = 7, height = 7
    )

  }
</code></pre>

<p><img src="https://raw.githubusercontent.com/gu-stat/forest-area/master/gif/Y1985.png"/></p>

<p><img src="https://raw.githubusercontent.com/gu-stat/forest-area/master/gif/Y2017.png""/></p>

    </div>

    


<div class="article-tags">
  
  <a class="badge badge-light" href="/tags/ggplot2/">ggplot2</a>
  
  <a class="badge badge-light" href="/tags/map/">map</a>
  
  <a class="badge badge-light" href="/tags/gif/">gif</a>
  
  <a class="badge badge-light" href="/tags/r/">R</a>
  
</div>



    



  







    
    

    

    


  </div>
</article>

<div class="container">
  <footer class="site-footer">
  
  <p class="powered-by">
    <a href="/privacy/">Privacy Policy</a>
  </p>
  

  <p class="powered-by">
    &copy; 2018 &middot; 

    Powered by the
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
    <span class="float-right" aria-hidden="true">
      <a href="#" id="back_to_top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
</footer>

</div>


<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

    

    
    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha512-+NqPlbbtM1QqiK8ZAo4Yrj2c4lNQoGv8P79DPtKzj++l5jnN39rHA/xsqn8zE9l0uSoxaCdrOgFs6yjyfbBxSg==" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.3/imagesloaded.pkgd.min.js" integrity="sha512-umsR78NN0D23AzgoZ11K7raBD+R6hqKojyBZs1w8WvYlsI+QuKRGBx3LFCwhatzBunCjDuJpDHwxD13sLMbpRA==" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha256-VsEqElsCHSGmnmHXGQzvoWjWwoznFSZc6hs7ARLRacQ=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.4/isotope.pkgd.min.js" integrity="sha512-VDBOIlDbuC4VWxGJNmuFRQ0Li0SKkDpmGyuhAG5LTDLd/dJ/S0WMVxriR2Y+CyPL5gzjpN4f/6iqWVBJlht0tQ==" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" integrity="sha256-X5PoE3KU5l+JcX+w09p/wHl9AzK333C4hJ2I9S5mD4M=" crossorigin="anonymous"></script>

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>
        
      

      
      
    

    
    

    
    
    

    
    
    <script>hljs.initHighlightingOnLoad();</script>
    

    
    
    <script>
      const search_index_filename = "/index.json";
      const i18n = {
        'placeholder': "Search...",
        'results': "results found",
        'no_results': "No results found"
      };
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    
    
    
    
    
    
    
    <script src="/js/academic.min.d037ee5294b166a79dec317c58aea9cc.js"></script>

    
    <script src="/js/timelineSkills.js"></script>
    

  </body>
</html>

