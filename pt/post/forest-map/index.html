<!DOCTYPE html>
<html lang="pt">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 3.2.0">
  <meta name="generator" content="Hugo 0.55.4" />
  <meta name="author" content="Gustavo Varela Alvarenga">

  
  
  
  
    
  
  <meta name="description" content="Crie um Mapa no R com ggplot e transforme-o em um gif">

  
  <link rel="alternate" hreflang="en" href="/post/forest-map/">
  
  <link rel="alternate" hreflang="pt" href="/pt/post/forest-map/">

  


  

  

  

  

  

  

  
  
  
  <meta name="theme-color" content="#21ABFF">
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha256-eSi1q2PG6J7g7ib17yAaWMcrr5GrtohYChqibrV7PBE=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css" integrity="sha384-5sAR7xN1Nv6T6+dT2mhtzEpVJvfS3NScPQTrOxhwjIuvcA67KV2R5Jz6kr4abQsz" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" integrity="sha256-ygkqlh3CYSUri3LhQxzdcm0n1EQvH2Y+U5S2idbLtxs=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" crossorigin="anonymous">
        
      
    

    

    

  

  
  
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Montserrat:400,700|Roboto:400,400italic,700|Roboto+Mono">
  

  <link rel="stylesheet" href="/pt/styles.css">
  
  <link rel="stylesheet" href="/css/timelineSkillsCSS.css">
  
  <link rel="stylesheet" href="/css/sharelinksCSS.css">
  

  
  
  

  
  <link rel="alternate" href="/index.xml" type="application/rss+xml" title="Gustavo Varela Alvarenga">
  <link rel="feed" href="/index.xml" type="application/rss+xml" title="Gustavo Varela Alvarenga">
  

  <link rel="manifest" href="/site.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="/pt/post/forest-map/">

  
  
  
  
    
  
  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="twitter:site" content="@ogustavo_com">
  <meta property="twitter:creator" content="@ogustavo_com">
  
  <meta property="og:site_name" content="Gustavo Varela Alvarenga">
  <meta property="og:url" content="/pt/post/forest-map/">
  <meta property="og:title" content="Crie um Mapa no R com ggplot e transforme-o em um gif | Gustavo Varela Alvarenga">
  <meta property="og:description" content="Crie um Mapa no R com ggplot e transforme-o em um gif"><meta property="og:image" content="/pt/post/forest-map/featured.png">
  <meta property="og:locale" content="pt">
  
  <meta property="article:published_time" content="2019-04-26T00:00:00-04:00">
  
  <meta property="article:modified_time" content="2019-04-27T00:00:00-04:00">
  

  

  

  <title>Crie um Mapa no R com ggplot e transforme-o em um gif | Gustavo Varela Alvarenga</title>

</head>
<body id="top" data-spy="scroll" data-target="#TableOfContents" data-offset="71" >
  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" role="textbox" spellcheck="false" type="search">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


<nav class="navbar navbar-light fixed-top navbar-expand-lg py-0" id="navbar-main">
  <div class="container">

    
      <a class="navbar-brand" href="/pt">Gustavo Varela Alvarenga</a>
      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Alterar navegação">
        <span><i class="fas fa-bars"></i></span>
      </button>
      

    
    <div class="collapse navbar-collapse" id="navbar">

      
      
      <ul class="navbar-nav ml-auto">
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/pt/#about">
            
            <span>Principal</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/pt/#experience">
            
            <span>Experiência</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/pt/#skills">
            
            <span>Programação</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/pt/#projects">
            
            <span>Shiny Apps</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/pt/#publications">
            
            <span>Publicações</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/pt/#contact">
            
            <span>Contato</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/pt/files/CV_Varela_Alvarenga.pdf">
            
            <span>CV</span>
            
          </a>
        </li>

        
        

      

        

        
        <li class="nav-item">
          <a class="nav-link js-search" href="#"><i class="fas fa-search" aria-hidden="true"></i></a>
        </li>
        

        
        <li class="nav-item dropdown">
          <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true">
            <i class="fas fa-globe" aria-hidden="true"></i>
            <span>Português</span>
          </a>
          <ul class="dropdown-menu">
            
            <li class="dropdown-item my-0 py-0 mx-0 px-0">
              <a href="/post/forest-map/">
                <span>English</span>
              </a>
            </li>
            
          </ul>
        </li>
        

        
        <li class="nav-item">
          <a class="nav-link js-dark-toggle" href="#"><i class="fas fa-moon" aria-hidden="true"></i></a>
        </li>
        

      </ul>

    </div>
  </div>
</nav>


<article class="article" itemscope itemtype="http://schema.org/Article">

  












  

  
  
  
<div class="article-container pt-3">
  <h1 itemprop="name">Crie um Mapa no R com ggplot e transforme-o em um gif</h1>

  

  
    

<div class="article-metadata">

  
  
  
  <div>
    <span itemscope itemprop="author" itemtype="http://schema.org/Person">
      <span itemprop="name">G Varela-Alvarenga</span>
    </span>
    
  </div>
  

  <span class="article-date">
    
        Last updated on
    
    <meta content="2019-04-26 00:00:00 -0400 EDT" itemprop="datePublished">
    <time datetime="2019-04-27 00:00:00 -0400 EDT" itemprop="dateModified">
      Apr 27, 2019
    </time>
  </span>
  <span itemscope itemprop="publisher" itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Gustavo Varela Alvarenga">
  </span>

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    14 min read
  </span>
  

  
  

  

  
  
<div class="share-box" aria-hidden="true">
  <ul class="share">
    
    
    <div class="a2a_kit a2a_kit_size_32 a2a_default_style">
      <a class="a2a_button_whatsapp"></a>
      <a class="a2a_button_twitter"></a>
      <a class="a2a_button_linkedin"></a>
      <a class="a2a_button_facebook"></a>
      <a class="a2a_button_copy_link"></a>
    <a class="a2a_dd" href="https://www.addtoany.com/share"></a>
    </div>
    <script>
      var a2a_config = a2a_config || {};
      a2a_config.linkname = "\"Crie um Mapa no R com ggplot e transforme-o em um gif\"";
      a2a_config.linkurl = "https://ogustavo.com\/pt\/post\/forest-map\/";
    </script>
    <script async src="https://static.addtoany.com/menu/page.js"></script>
    
    
  </ul>
</div>


  

</div>

    







  









  
</div>



  <div class="article-container">

    <div class="article-style" itemprop="articleBody">
      

<h2 id="seção-1-introdução">Seção 1: Introdução</h2>

<p>Em março de 2019, o Projeto de Mapeamento Anual da Cobertura e Uso do Solo do Brasil  (MapBiomas) (<a href="http://mapbiomas.org/" target="_blank">http://mapbiomas.org/</a>) lançou o banco de dados Mapbiomas v.3.1 sobre uso e cobertura da terra para o período de 1985 a 2017.</p>

<p>Este conjunto de dados contém informações sobre a área total (em hectares) de formações florestais, formações naturais não-florestais, agricultura, áreas sem vegetação e corpos d&rsquo;água - informações detalhadas sobre estas formações e suas subdivisões podem ser encontradas <a href="https://storage.googleapis.com/mapbiomas/assets/colecao-3-0/mapas-dados/1%20-%20Legenda%20Cole%C3%A7%C3%A3o%203%20-%20Descricao%20Detalhada.pdf" target="_blank">aqui</a>.</p>

<p>E ainda que o site forneça ferramentas para qualquer um criar seus próprios mapas, decidi criar meu próprio mapa animado usando R e os pacotes <code>ggplot2</code> e <code>gifski</code> porque queria ver a porcentagem de uma área da cidade que é coberta por vegetação nativa.
Eu também estou usando o pacote <code>brazilmaps</code> para traçar o mapa do Brasil.</p>

<p>Eu queria me concentrar apenas nos dados da Formação Florestal Natural e ver como sua área total evoluiu desde 1985.</p>

<p>Este tutorial tem 3 seções, além desta introdução. A segunda seção é apenas sobre os pacotes e fontes que eu usei e como baixar essas fontes. Na Seção 3, examino o conjunto de dados e falo sobre suas variáveis e suas definições. Eu também passo por etapas de importar o conjunto de dados e fazer algumas manipulações de dados para obter as informações que desejo. A seção 4 fornece o código para o mapa final.</p>

<p>Você pode baixar o arquivo <code>.R</code> com o código completo do meu <a href="https://github.com/gu-stat/forest-area" target="_blank">GitHub</a>.</p>

<h2 id="seção-2-pacotes">Seção 2: Pacotes</h2>

<p>Começarei examinando as fontes que usei e como instalá-las. Eu uso o Windows, então não sei se os mesmos passos se aplicam a outros sistemas (desculpe usuários Mac e Unix).</p>

<p>Estou usando Lato, uma família de fontes de código aberto. Então, certifique-se de baixar e instalar a fonte Lato antes de começar ou você pode deixar R usar a fonte padrão do sistema - você não terá que alterar o código, você receberá algumas mensagens de aviso, mas R ainda irá traçar o mapa .</p>

<p>Você pode baixá-la <a href="http://www.latofonts.com/lato-free-fonts/" target="_blank">aqui</a>.</p>

<p>A primeira coisa que faço é ter certeza de que R pode usar essa fonte, então vou usar o pacote <code>extrafont</code> para isso. Se é a primeira vez que você usa essas fontes, você terá que executar o comando <code>font_import ()</code> (isso pode demorar um pouco dependendo do número de fontes instaladas que você possui, o bom é que você terá que executar este comando apenas uma vez).</p>

<pre><code class="language-r"># ************************************************************************* ----
# Pacote extrafont                                                          ----
# ************************************************************************* ----

#install.packages(&quot;extrafont&quot;)

library(&quot;extrafont&quot;)

# ************************************************************************* ----
# Importar Fonte                                                            ----
# ************************************************************************* ----

# Instale a fonte Lato

# Rode font_import apenas uma vez:

# font_import()

# Verifique se Lato foi incluida
fonts()[grep(&quot;Lato&quot;, fonts())]

# Registre as fontes no R

loadfonts(device = &quot;win&quot;)

# ************************************************************************* ----
# Outros Pacotes                                                            ----
# ************************************************************************* ----

#install.packages(&quot;openxlsx&quot;)
#install.packages(&quot;tidyverse&quot;)
#install.packages(&quot;brazilmaps&quot;)
#install.packages(&quot;gifski&quot;)

library(&quot;openxlsx&quot;)
library(&quot;tidyverse&quot;)
library(&quot;brazilmaps&quot;)
library(&quot;gifski&quot;)
</code></pre>

<h2 id="section-3-os-dados">Section 3: Os Dados</h2>

<h3 id="dando-os-devidos-créditos">Dando os devidos créditos</h3>

<p>Os dados do Projeto MapBiomas são públicos, abertos e gratuitos através da simples referência da fonte:</p>

<p>&ldquo;Projeto MapBiomas – Coleção 3.1 da Série Anual de Mapas de Cobertura e Uso de Solo do Brasil, acessado em 24/04/2019 através do link:(<a href="http://mapbiomas.org/pages/estatisticas)&quot;" target="_blank">http://mapbiomas.org/pages/estatisticas)&quot;</a></p>

<p>&ldquo;Projeto MapBiomas - é uma iniciativa multi-institucional para gerar mapas anuais de cobertura e uso do solo a partir de processos de classificação automática aplicada a imagens de satélite. A descrição completa do projeto encontra-se em <a href="http://mapbiomas.org" target="_blank">http://mapbiomas.org</a>&ldquo;</p>

<p>Também estou usando dados sobre a área das cidades no Brasil do IBGE (Instituto Brasileiro de Geografia e Estatística). Devido às mudanças no tamanho das cidades ao longo dos anos, decidi usar os dados de 2016. Eu estava obtendo alguns resultados incorretos usando dados de 2017 ou 2018, como cidades com mais de 100% de sua área coberta por vegetação nativa. Claramente, essas cidades foram divididas, mas isso não foi contabilizado no conjunto de dados do MapBiomas. Não foram observadas cidades com mais de 100% de sua área coberta por vegetação nativa ao utilizar dados de 2016.</p>

<p>O código abaixo importa os conjuntos de dados para R, mas se você quiser, pode baixar os arquivos xlsx dos sites oficiais clicando em
 <a href="https://storage.googleapis.com/mapbiomas/mapbiomas-br/v3-1/planilhas%20de%20estatisticas%203-1/Dados_Cobertura_MapBiomas_3.1_Biomas-UF-Municipios_%20SITE.xlsx" target="_blank">aqui</a> para o banco de dados do MapBiomas e <a href="ftp://geoftp.ibge.gov.br/organizacao_do_territorio/estrutura_territorial/areas_territoriais/2016/AR_BR_RG_UF_MUN_2016.xls" target="_blank">aqui</a> para os dados do IBGE.</p>

<p>Para manter meu código, também estou fazendo o upload dos bancos de dados originais para o meu <a href="https://github.com/gu-stat/forest-area" target="_blank">repositório GitHub</a> e esses são os dados que vou usar no meu código abaixo.</p>

<h3 id="dicionário-de-dados">Dicionário de Dados</h3>

<p>O arquivo xlsx do MapBiomas possui as seguintes planilhas:</p>

<ul>
<li>INSTRUCTIONS;</li>
<li>LAND COVER - BIOMAS e UF;</li>
<li>LAND COVER - MUN_UF;</li>
<li>CONSULTA BIOMA-UF; e</li>
<li>CONSULTA MUN-UF.</li>
</ul>

<p>Usarei a planilha LAND COVER - MUN_UF. As variáveis dessa planilha são:</p>

<table>
<thead>
<tr>
<th>Variável</th>
<th>Classe</th>
<th>Descrição</th>
</tr>
</thead>

<tbody>
<tr>
<td>COD_ESTADO</td>
<td>numeric</td>
<td>identificador do Estado</td>
</tr>

<tr>
<td>estado</td>
<td>character</td>
<td>nome do Estado</td>
</tr>

<tr>
<td>CODIBGE</td>
<td>numeric</td>
<td>identificador do municipio</td>
</tr>

<tr>
<td>municipio</td>
<td>character</td>
<td>nome do municipio</td>
</tr>

<tr>
<td>cod.classe</td>
<td>numeric</td>
<td>identificador do tipo de classe de cobertura terrestre</td>
</tr>

<tr>
<td>nivel1</td>
<td>character</td>
<td>classe nível 1</td>
</tr>

<tr>
<td>nivel2</td>
<td>character</td>
<td>classe nível 2</td>
</tr>

<tr>
<td>nivel3</td>
<td>character</td>
<td>classe nível 3</td>
</tr>

<tr>
<td>1985</td>
<td>numeric</td>
<td>área coberta em hectares(ha) em 1985</td>
</tr>

<tr>
<td>&hellip;</td>
<td>&hellip;</td>
<td>&hellip;</td>
</tr>

<tr>
<td>2017</td>
<td>numeric</td>
<td>área coberta em hectares(ha) em 2017</td>
</tr>
</tbody>
</table>

<p>O arquivo xlsx do IBGE possui as seguintes planilhas:</p>

<ul>
<li>AR_BR_MUN_2016;</li>
<li>AR_BR_UF_2016;</li>
<li>AR_BR_RG_2016; e</li>
<li>AR_BR_2016.</li>
</ul>

<p>Usarei a planilha AR_BR_MUN_2016. As variáveis dessa planilha são:</p>

<p>The variables in IBGE&rsquo;s AR_BR_MUN_2016 data set are:</p>

<table>
<thead>
<tr>
<th>Variável</th>
<th>Classe</th>
<th>Descrição</th>
</tr>
</thead>

<tbody>
<tr>
<td>ID</td>
<td>numeric</td>
<td>ID</td>
</tr>

<tr>
<td>CD_GCUF</td>
<td>character</td>
<td>identificador do Estado</td>
</tr>

<tr>
<td>NM_UF</td>
<td>character</td>
<td>nome do Estado</td>
</tr>

<tr>
<td>NM_UF_SIGLA</td>
<td>character</td>
<td>UF</td>
</tr>

<tr>
<td>CD_GCMUN</td>
<td>character</td>
<td>identificador do municipio</td>
</tr>

<tr>
<td>NM_MUN_2016</td>
<td>character</td>
<td>nome do municipio</td>
</tr>

<tr>
<td>AR_MUN_2016</td>
<td>numeric</td>
<td>área em km quadrados</td>
</tr>
</tbody>
</table>

<pre><code class="language-r"># ************************************************************************* ----
# Importar os Dados                                                         ----
# ************************************************************************* ----

# Mudar formato dos numeros
options(scipen=10)

# Caminho para o Arquivo no GitHub
file_path_forest_area = paste0(
  &quot;https://github.com/gu-stat/forest-area/blob/master/&quot;,
  &quot;data/Dados_Cobertura_MapBiomas_3.1_Biomas-UF-Municipios_%20SITE_UNPROTECTED.xlsx&quot;,
  &quot;?raw=true&quot;)

file_path_city_area = paste0(
  &quot;https://github.com/gu-stat/forest-area/blob/master/&quot;,
  &quot;data/AR_BR_RG_UF_MUN_2016.xlsx&quot;,
  &quot;?raw=true&quot;)

# Importacao
df.original &lt;- openxlsx::read.xlsx(file_path_forest_area, 
                                   sheet = &quot;LAND COVER - MUN_UF&quot;)

df.city.area &lt;- openxlsx::read.xlsx(file_path_city_area, 
                                    sheet = &quot;AR_BR_MUN_2016&quot;)

## \__ Dados para Criar Mapa por Cidade ----

brazil.map &lt;- get_brmap(geo = &quot;City&quot;, class = &quot;sf&quot;)
</code></pre>

<h3 id="manipulação-de-dados">Manipulação de dados</h3>

<pre><code class="language-r"># ************************************************************************* ----
# Manipulacao dos Dados                                                     ----
# ************************************************************************* ----

## \__ Transforma Codigo da Cidade em Numerico ----

df.city.area2 &lt;-
  df.city.area %&gt;% 
  dplyr::mutate(CODIBGE = as.numeric(CD_GCMUN)) %&gt;% 
  dplyr::select(CODIBGE, AR_MUN_2016)


## \__ Dados de Area de Cobertura de Florestas Natuais ----

df.nat.forest &lt;- 
  df.original %&gt;% 
  filter(nivel2 == &quot;Floresta Natural&quot;) %&gt;%
  select(COD_ESTADO, estado, CODIBGE, nivel2, nivel3, 
         paste0(seq(1985, 2017))
  ) %&gt;%
  # SOMA OS DIFERENTES SUB-GRUPOS DE Floresta Natural
  group_by(COD_ESTADO, estado, CODIBGE) %&gt;%
  summarize_at(vars(-nivel2,-nivel3),sum) %&gt;%
  ungroup()

## \__ Juntar com Dados de Area da Cidade ----

df.nat.forest.AREA &lt;- 
  df.nat.forest %&gt;%
  # ADICIONA AREA DE CADA CIDADE NA BASE COM DADOS DE VEGETACAO 
  dplyr::left_join(x = ., y = df.city.area2, by = &quot;CODIBGE&quot;) %&gt;%
  # CRIA PERCENTUAIS
  ## FAZ x/100 PARA TRANSFORMAR DE HECTARES PARA KM2
  dplyr::mutate_at(.vars=vars(paste0(seq(1985,2017))), 
                   .fun = function(x) round(100*((x/100)/.$AR_MUN_2016),3)
  )


# VERIFICA SE ALGUM MUNICIPIO TEM MAIS DE 100%
greater.1 &lt;- NULL 
for (i in 1985:2017) {
  greater.1 &lt;- append(greater.1, which(df.nat.forest.AREA[,paste0(i)] &gt;= 100))
}

greater.1 &lt;- greater.1 %&gt;% unlist() %&gt;% unique()

## \__ Cria os limites de percentuais ----

df.nat.forest.AREA &lt;- 
  df.nat.forest.AREA %&gt;%
  dplyr::mutate_at(.vars=vars(paste0(seq(1985,2017))), 
                   .fun = function(x) cut(x,breaks=c(-Inf, 0, 1, seq(0, 100, 10)[-1]))
  )
</code></pre>

<h2 id="seção-4-o-mapa">Seção 4: O Mapa</h2>

<pre><code class="language-r"># ************************************************************************* ----
# Mapa                                                                      ----
# ************************************************************************* ----

## \__ Funcao que junta os dados de vegetacao com os de posicao das cidades ----

create.map.df &lt;- function(DATA){
  
  map &lt;- join_data(map = brazil.map, data = DATA, by = c(&quot;City&quot; = &quot;CODIBGE&quot;))  
  
  map.ggplot &lt;- as(map, &quot;Spatial&quot;)
  
  map.ggplot@data$id = row.names(map.ggplot@data)
  
  df.map.ggplot &lt;- suppressMessages(ggplot2::fortify(map.ggplot))
  
  df.map.ggplot &lt;- dplyr::left_join(df.map.ggplot, map.ggplot@data, by = &quot;id&quot;)
  
  return(df.map.ggplot)
}

## \____ Base de dados Para criar o Mapa ----

df.map.ggplot &lt;- create.map.df(df.nat.forest.AREA)

## \__ Map Colors ----

# USEI https://gka.github.io/palettes PARA OBTER UMA ESCALA DE CORES
# COM 12 INTERVALOS (MESMO NUMERO DE INTERVALOS DE
# cut(x,breaks=c(-Inf, 0, 1, seq(0, 100, 10)[-1])) )
# QUE VAI DE white ATE darkgreen QUE EH APROPRIADA PARA PESSOAS COM
# VARIOS TIPOS DE DALTONISMO 

map.colors &lt;- c('#ffffff','#eaf1e7','#d4e2cf','#bfd4b8','#abc5a1','#96b78a',
                '#81a974','#6c9b5f','#588d4a','#428034','#28711d','#006400')

### \__ Rotulos para a Legenda ----

map.labels &lt;- c(&quot;0&quot;, &quot;&quot;, &quot;10%&quot;, rep(&quot;&quot;,3), &quot;50%&quot;, rep(&quot;&quot;,3), &quot;90%&quot;, &quot;&quot;)

## \__ Criar Tema para o Mapa ----

map.theme &lt;-
  theme(
    text = element_text(size = 12, family = &quot;Lato&quot;, color = &quot;#f2efef&quot;),
    axis.text = element_blank(),
    axis.title.x = element_blank(),
    axis.title.y = element_blank(),
    plot.background = element_rect(fill = &quot;#3a3935&quot;, color = NA), 
    panel.background = element_rect(fill = &quot;#3a3935&quot;, color = NA),
    panel.grid = element_blank(),
    plot.margin = margin(t = 0.25,r = 0.25,b = 0.25,l = 0.25,unit = &quot;cm&quot;),
    plot.title = element_text(margin = margin(t = 0.25, unit = &quot;cm&quot;)),
    plot.caption = element_text(size = 10),
    legend.background = element_rect(fill = &quot;#3a3935&quot;, color = &quot;#3a3935&quot;),
    legend.text = element_text(size = 11),
    legend.title = element_text(size = 12),
    legend.position = &quot;left&quot;,
    legend.key = element_rect(color = &quot;transparent&quot;),
    legend.key.size = unit(0, units = &quot;mm&quot;),
    legend.key.width = unit(2, units = &quot;mm&quot;)
  )

## \__ Plotar Mapa ----

### \____ Funcao para o GIF ----
plot.map.forest &lt;- function(){
  for (i in 1985:2017) {
    
    lost.area.year.km2 &lt;-
      round(
        sum(-(df.nat.forest %&gt;% summarize_at(paste0(i),sum)/100),
            df.nat.forest %&gt;% summarize_at(paste0(1985),sum)/100)
        ,2
      )
    
    lost.area.year.mi2 &lt;- round(lost.area.year.km2/2.59, 2)
    
    map.forest &lt;-
      # MAPA
      ggplot(mapping = aes(x = long, y = lat, group = group)) +
      # MAPA COM LINHAS DA CIDADE TRANSPARENTES
      geom_polygon(
        data = df.map.ggplot,
        aes_string(fill = paste0(&quot;X&quot;,i)),
        color = &quot;transparent&quot;
      ) +
      # LEGENDA
      scale_fill_manual(
        values = map.colors,
        drop = FALSE,
        na.value = &quot;black&quot;,
        na.translate = FALSE,
        name = &quot;&quot;,
        label = map.labels,
        guide = guide_legend(
          direction = &quot;vertical&quot;,
          ncol = 1,
          reverse = TRUE,
          label.vjust = 2.5
        )
      ) +
      # LIMITES DO MAPA
      xlim(range(df.map.ggplot$long)) +
      ylim(range(df.map.ggplot$lat)) +
      coord_map() +
      # ADICIONAR TITULO E CAPTIONS
      labs(
        title = &quot;Percentual da Área da Cidade coberta por Vegetação Nativa, Brasil.&quot;,
        caption = paste0(&quot;Mapa: Gustavo Varela-Alvarenga - ogustavo.com/pt \n \n &quot;,
                         &quot;Dados: MapBiomas v.3.1 - mapbiomas.org &amp; &quot;,
                         &quot;IBGE - www.ibge.gov.br &quot;)
      ) +
      # ADICIONAR TEMA
      map.theme +
      # ADICIONAR ANNOTATIONS
      ## PALAVRA ANO
      annotate(
        geom = &quot;text&quot;, x = -44.1, y = 2.4, size = 4, family = &quot;Lato&quot;,
        color = &quot;#f2efef&quot;, label = &quot;ano&quot;, angle = 90
      ) +
      ## VALOR DO ANO
      annotate(
        geom = &quot;text&quot;, x = -40, y = 2.5, size = 10, family = &quot;Lato&quot;,
        color = &quot;#f2efef&quot;, label = paste0(i)
      ) +
      ## TITULO - TABELA A ESQUERDA
      annotate(
        geom = &quot;text&quot;, x = -68.5, y = -26, size = 4, family = &quot;Lato&quot;,
        color = &quot;#f2efef&quot;, hjust = 0.5,
        label =
          paste0(&quot;Área Total de Vegetação \n&quot;, &quot;Nativa Perdida Desde 1985&quot;)
      ) +
      ## LINHA ABAIXO TITULO
      annotate(
        geom = &quot;segment&quot;, x = -64.5, xend = -72.5, y = -28, yend = -28,
        linetype = &quot;solid&quot;, color = &quot;#f2efef&quot;
      ) +
      ## VALORES EM KMs QUADRADOS COM . PARA MARCAR OS MILHARES
      annotate(
        geom = &quot;text&quot;, x = -68.5, y = -29, size = 4.5, family = &quot;Lato&quot;,
        color = &quot;#f2efef&quot;, hjust = 0.5,
        label =
          ifelse(lost.area.year.km2 == 0, &quot;0&quot;,
                 paste0(prettyNum(round(lost.area.year.km2, 0),
                                  big.mark=&quot;.&quot;, decimal.mark = &quot;,&quot;),
                        &quot; km2&quot;)
          )
      ) +
      ## VALORES EM MILHAS QUADRADAS COM , PARA MARCAR OS MILHARES
      annotate(
        geom = &quot;text&quot;, x = -68.5, y = -31, size = 4.5, family = &quot;Lato&quot;,
        color = &quot;#f2efef&quot;, hjust = 0.5,
        label =
          ifelse(lost.area.year.mi2 == 0, &quot;0&quot;,
                 paste0(prettyNum(round(lost.area.year.mi2, 0), big.mark=&quot;,&quot;),
                        &quot; milhas2&quot;)
          )
      ) +
      ## LINHA ABAIXO TABELA
      annotate(
        geom = &quot;segment&quot;, x = -64.5, xend = -72.5, y = -32, yend = -32,
        linetype = &quot;solid&quot;, color = &quot;#f2efef&quot;
      ) +
      ## TITULO - TABELA A DIREITA
      annotate(
        geom = &quot;text&quot;, x = -39, y = -26, size = 4, family = &quot;Lato&quot;,
        color = &quot;#f2efef&quot;, hjust = 0.5,
        label =  paste0(&quot;Área Perdida em \n&quot;, &quot;% da Área do(a)&quot;)
      ) +
      ## LINHA ABAIXO TITULO
      annotate(
        geom = &quot;segment&quot;, x = -35, xend = -43, y = -28, yend = -28,
        linetype = &quot;solid&quot;, color = &quot;#f2efef&quot;
      ) +
      ## ADICIONAR PALAVRA TEXAS
      annotate(
        geom = &quot;text&quot;, x = -41, y = -29, size = 4.5, family = &quot;Lato&quot;,
        color = &quot;#f2efef&quot;, label =  &quot;Texas        : &quot;
      ) +
      ## ADICIONAR PERCENTUAL PARA TEXAS
      annotate(
        geom = &quot;text&quot;, x = -34, y = -29, size = 4.5, family = &quot;Lato&quot;,
        color = &quot;#f2efef&quot;, hjust = 1,
        label =
          ifelse(
            lost.area.year.km2 == 0, &quot;0%&quot;,
            paste0(round(lost.area.year.km2/696241, 2) * 100, &quot;%&quot;)
          )
      ) +
      ## ADICIONAR PALAVRA ALEMANHA
      annotate(
        geom = &quot;text&quot;, x = -41, y = -31, size = 4.5, family = &quot;Lato&quot;,
        color = &quot;#f2efef&quot;, label =  &quot;Alemanha : &quot;
      ) +
      ## ADICIONAR PERCENTUAL PARA ALEMANHA
      annotate(
        geom = &quot;text&quot;, x = -34, y = -31, size = 4.5, family = &quot;Lato&quot;,
        color = &quot;#f2efef&quot;, hjust = 1,
        label =
          ifelse(
            lost.area.year.km2 == 0, &quot;0%&quot;,
            paste0(round(lost.area.year.km2/357386, 2) * 100, &quot;%&quot;)
          )
      ) +
      ## LINHA ABAIXO DA TABELA
      annotate(
        geom = &quot;segment&quot;, x = -35, xend = -43, y = -32, yend = -32,
        linetype = &quot;solid&quot;, color = &quot;#f2efef&quot;
      )
    
    print(map.forest)
    
  }
}
</code></pre>

<pre><code class="language-r">### \____ Criar GIF ----
### O comando abaixo salvara um arquivo gif de nome forest_animation_pt-br.gif 
### no seu working directory

gif_file &lt;-
  gifski::save_gif(
    expr = plot.map.forest(),
    gif_file = &quot;forest_animation_pt-br.gif&quot;,
    delay = 0.75, width = 738, height = 788, res = 100
  )

utils::browseURL(gif_file)
</code></pre>

<p><img src="https://raw.githubusercontent.com/gu-stat/forest-area/master/gif/forest_animation_pt-br.gif"/></p>

<p>Se você quiser, você pode usar o código abaixo para obter imagens estáticas de alta qualidade dos mapas. Esteja ciente de que isso salvará os gráficos em seu diretório de trabalho.</p>

<pre><code class="language-r">### \____ Criar Mapas Estaticos ----
#install.packages(&quot;Cairo&quot;)
library(&quot;Cairo&quot;)

for (i in 1985:2017) {
  
  lost.area.year.km2 &lt;-
    round(
      sum(-(df.nat.forest %&gt;% summarize_at(paste0(i),sum)/100),
          df.nat.forest %&gt;% summarize_at(paste0(1985),sum)/100)
      ,2
    )
  
  lost.area.year.mi2 &lt;- round(lost.area.year.km2/2.59, 2)
  
  map.forest &lt;-
    # MAPA
    ggplot(mapping = aes(x = long, y = lat, group = group)) +
    # MAPA COM LINHAS DA CIDADE TRANSPARENTES
    geom_polygon(
      data = df.map.ggplot,
      aes_string(fill = paste0(&quot;X&quot;,i)),
      color = &quot;transparent&quot;
    ) +
    # LEGENDA
    scale_fill_manual(
      values = map.colors,
      drop = FALSE,
      na.value = &quot;black&quot;,
      na.translate = FALSE,
      name = &quot;&quot;,
      label = map.labels,
      guide = guide_legend(
        direction = &quot;vertical&quot;,
        ncol = 1,
        reverse = TRUE,
        label.vjust = 2.5
      )
    ) +
    # LIMITES DO MAPA
    xlim(range(df.map.ggplot$long)) +
    ylim(range(df.map.ggplot$lat)) +
    coord_map() +
    # ADICIONAR TITULO E CAPTIONS
    labs(
      title = &quot;Percentual da Área da Cidade coberta por Vegetação Nativa, Brasil.&quot;,
      caption = paste0(&quot;Mapa: Gustavo Varela-Alvarenga - ogustavo.com/pt \n \n &quot;,
                       &quot;Dados: MapBiomas v.3.1 - mapbiomas.org &amp; &quot;,
                       &quot;IBGE - www.ibge.gov.br &quot;)
    ) +
    # ADICIONAR TEMA
    map.theme +
    # ADICIONAR ANNOTATIONS
    ## PALAVRA ANO
    annotate(
      geom = &quot;text&quot;, x = -44.1, y = 2.4, size = 4, family = &quot;Lato&quot;,
      color = &quot;#f2efef&quot;, label = &quot;ano&quot;, angle = 90
    ) +
    ## VALOR DO ANO
    annotate(
      geom = &quot;text&quot;, x = -40, y = 2.5, size = 10, family = &quot;Lato&quot;,
      color = &quot;#f2efef&quot;, label = paste0(i)
    ) +
    ## TITULO - TABELA A ESQUERDA
    annotate(
      geom = &quot;text&quot;, x = -68.5, y = -26, size = 4, family = &quot;Lato&quot;,
      color = &quot;#f2efef&quot;, hjust = 0.5,
      label =
        paste0(&quot;Área Total de Vegetação \n&quot;, &quot;Nativa Perdida Desde 1985&quot;)
    ) +
    ## LINHA ABAIXO TITULO
    annotate(
      geom = &quot;segment&quot;, x = -64.5, xend = -72.5, y = -28, yend = -28,
      linetype = &quot;solid&quot;, color = &quot;#f2efef&quot;
    ) +
    ## VALORES EM KMs QUADRADOS COM . PARA MARCAR OS MILHARES
    annotate(
      geom = &quot;text&quot;, x = -68.5, y = -29, size = 4.5, family = &quot;Lato&quot;,
      color = &quot;#f2efef&quot;, hjust = 0.5,
      label =
        ifelse(lost.area.year.km2 == 0, &quot;0&quot;,
               paste0(prettyNum(round(lost.area.year.km2, 0),
                                big.mark=&quot;.&quot;, decimal.mark = &quot;,&quot;),
                      &quot; km2&quot;)
        )
    ) +
    ## VALORES EM MILHAS QUADRADAS COM , PARA MARCAR OS MILHARES
    annotate(
      geom = &quot;text&quot;, x = -68.5, y = -31, size = 4.5, family = &quot;Lato&quot;,
      color = &quot;#f2efef&quot;, hjust = 0.5,
      label =
        ifelse(lost.area.year.mi2 == 0, &quot;0&quot;,
               paste0(prettyNum(round(lost.area.year.mi2, 0), big.mark=&quot;,&quot;),
                      &quot; milhas2&quot;)
        )
    ) +
    ## LINHA ABAIXO TABELA
    annotate(
      geom = &quot;segment&quot;, x = -64.5, xend = -72.5, y = -32, yend = -32,
      linetype = &quot;solid&quot;, color = &quot;#f2efef&quot;
    ) +
    ## TITULO - TABELA A DIREITA
    annotate(
      geom = &quot;text&quot;, x = -39, y = -26, size = 4, family = &quot;Lato&quot;,
      color = &quot;#f2efef&quot;, hjust = 0.5,
      label =  paste0(&quot;Área Perdida em \n&quot;, &quot;% da Área do(a)&quot;)
    ) +
    ## LINHA ABAIXO TITULO
    annotate(
      geom = &quot;segment&quot;, x = -35, xend = -43, y = -28, yend = -28,
      linetype = &quot;solid&quot;, color = &quot;#f2efef&quot;
    ) +
    ## ADICIONAR PALAVRA TEXAS
    annotate(
      geom = &quot;text&quot;, x = -41, y = -29, size = 4.5, family = &quot;Lato&quot;,
      color = &quot;#f2efef&quot;, label =  &quot;Texas        : &quot;
    ) +
    ## ADICIONAR PERCENTUAL PARA TEXAS
    annotate(
      geom = &quot;text&quot;, x = -34, y = -29, size = 4.5, family = &quot;Lato&quot;,
      color = &quot;#f2efef&quot;, hjust = 1,
      label =
        ifelse(
          lost.area.year.km2 == 0, &quot;0%&quot;,
          paste0(round(lost.area.year.km2/696241, 2) * 100, &quot;%&quot;)
        )
    ) +
    ## ADICIONAR PALAVRA ALEMANHA
    annotate(
      geom = &quot;text&quot;, x = -41, y = -31, size = 4.5, family = &quot;Lato&quot;,
      color = &quot;#f2efef&quot;, label =  &quot;Alemanha : &quot;
    ) +
    ## ADICIONAR PERCENTUAL PARA ALEMANHA
    annotate(
      geom = &quot;text&quot;, x = -34, y = -31, size = 4.5, family = &quot;Lato&quot;,
      color = &quot;#f2efef&quot;, hjust = 1,
      label =
        ifelse(
          lost.area.year.km2 == 0, &quot;0%&quot;,
          paste0(round(lost.area.year.km2/357386, 2) * 100, &quot;%&quot;)
        )
    ) +
    ## LINHA ABAIXO DA TABELA
    annotate(
      geom = &quot;segment&quot;, x = -35, xend = -43, y = -32, yend = -32,
      linetype = &quot;solid&quot;, color = &quot;#f2efef&quot;
    )
  
  ### Observe que o comando abaixo ira salvar varios arquivos
  ### png com nome Y*_pt-br.png, onde * eh o ano, no seu 
  ### working directory
  
  ggsave(
    paste0(&quot;Y&quot;,i,&quot;_pt-br.png&quot;), device=&quot;png&quot;, type=&quot;cairo&quot;, 
    width = 7, height = 7
  )
  
}
</code></pre>

<p><img src="https://raw.githubusercontent.com/gu-stat/forest-area/master/gif/Y1985_pt-br.png"/></p>

<p><img src="https://raw.githubusercontent.com/gu-stat/forest-area/master/gif/Y2017_pt-br.png"/></p>

    </div>

    


<div class="article-tags">
  
  <a class="badge badge-light" href="/pt/tags/ggplot2/">ggplot2</a>
  
  <a class="badge badge-light" href="/pt/tags/map/">map</a>
  
  <a class="badge badge-light" href="/pt/tags/gif/">gif</a>
  
  <a class="badge badge-light" href="/pt/tags/r/">R</a>
  
</div>



    



  







    
    

    

    


  </div>
</article>

<div class="container">
  <footer class="site-footer">
  

  <p class="powered-by">
    &copy; 2018 &middot; 

    Powered by the
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
    <span class="float-right" aria-hidden="true">
      <a href="#" id="back_to_top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
</footer>

</div>


<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

    

    
    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha512-+NqPlbbtM1QqiK8ZAo4Yrj2c4lNQoGv8P79DPtKzj++l5jnN39rHA/xsqn8zE9l0uSoxaCdrOgFs6yjyfbBxSg==" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.3/imagesloaded.pkgd.min.js" integrity="sha512-umsR78NN0D23AzgoZ11K7raBD+R6hqKojyBZs1w8WvYlsI+QuKRGBx3LFCwhatzBunCjDuJpDHwxD13sLMbpRA==" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha256-VsEqElsCHSGmnmHXGQzvoWjWwoznFSZc6hs7ARLRacQ=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.4/isotope.pkgd.min.js" integrity="sha512-VDBOIlDbuC4VWxGJNmuFRQ0Li0SKkDpmGyuhAG5LTDLd/dJ/S0WMVxriR2Y+CyPL5gzjpN4f/6iqWVBJlht0tQ==" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" integrity="sha256-X5PoE3KU5l+JcX+w09p/wHl9AzK333C4hJ2I9S5mD4M=" crossorigin="anonymous"></script>

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>
        
      

      
      
    

    
    

    
    
    

    
    
    <script>hljs.initHighlightingOnLoad();</script>
    

    
    
    <script>
      const search_index_filename = "/pt/index.json";
      const i18n = {
        'placeholder': "Search...",
        'results': "results found",
        'no_results': "No results found"
      };
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publicações",
        'talk' : "Palestras"
        };
    </script>
    

    
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    
    
    
    
    
    
    
    <script src="/js/academic.min.d037ee5294b166a79dec317c58aea9cc.js"></script>

    
    <script src="/js/timelineSkills.js"></script>
    

  </body>
</html>

